tasks:
  - script:
    - chmod +x ./bamboo-specs/build-via-jenkins.py
  - script:
    - ./bamboo-specs/build-via-jenkins.py --url ${bamboo.jenkins_url} --username ${bamboo.jenkins_username} --token ${bamboo.jenkins_token} --branch ${bamboo.planRepository.branchName} --buildid ${bamboo.buildNumber} --servicepath ${bamboo.service_path} --build ${bamboo.service} --imagetag ${bamboo.image_tag} --builddb ${bamboo.build_db} --runacctests ${bamboo.run_acceptance_tests} --rununittests ${bamboo.run_unit_tests}

artifacts:
    # Define multiple artifacts with the object divisor in YAML
    # -
    #   name: Unit Test Results
    #   location: artifacts/archive/TestResults/UnitTests/
    #   pattern: '**/*.xml'
    #   required: false
    # -
    #   name: Acceptance Test Results
    #   location: artifacts/archive/AcceptanceTests/tests/
    #   pattern: '**/TestResults/*.xml'
    #   required: false
    -
      name: Deployment Chart
      location: artifacts/archive/deploy
      pattern: '**/*'
      shared: true
    # -
    #   name: Code Coverage
    #   location: artifacts/archive/TestResults/TestCoverage
    #   pattern: '*.xml'

final-tasks:
    - test-parser:
        type: nunit
        test-results:
          - artifacts/archive/TestResults/UnitTests/**/*.xml
          - artifacts/archive/AcceptanceTests/tests/**/TestResults/*.xml