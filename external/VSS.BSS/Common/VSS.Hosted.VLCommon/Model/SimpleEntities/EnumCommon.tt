<#@ assembly name="EnvDTE" #>
<#@ assembly name="System.Xml" #> 
<#@ assembly name="System.Xml.Linq" #> 
<#@ assembly name="System.Core" #> 
<#@ assembly name="System.Data" #> 
<#@ assembly name="System.Data.Entity" #> 
<#@ import namespace="System.Linq" #> 
<#@ import namespace="System.Xml.Linq" #> 
<#@ import namespace="System.Data.Metadata.Edm" #> 
<#@ import namespace="System.Text.RegularExpressions" #> 
<#@ include file="EF.Utility.CS.ttinclude"#>
<#+
	void WriteHeader(EntityFrameworkTemplateFileManager fileManager)
	{
		fileManager.StartHeader();
	#>
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated from a template.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

<#+
	}
  void WriteNamespace()
  {
    CodeGenerationTools code = new CodeGenerationTools(this);
    string namespaceName = code.VsNamespaceSuggestion().Replace(".Model.SimpleEntities","");
#>
namespace <#=code.EscapeNamespace(namespaceName)#>
<#+
  }
  void BeginScope()
  {
#>
{
<#+
      PushIndent("  ");
  }

  void EndScope()
  {
      PopIndent();
#>
}
<#+
  }

  public string WriteEnum(string dbName, EntityType entity, string valueField, string nameField)
  {
    string connectionString = string.Format("Data Source=dev-nh-raw.c31ahitxrkg7.us-west-2.rds.amazonaws.com;user id=root;password=V55nhrawDev!;Initial Catalog={0};Integrated Security=False;MultipleActiveResultSets=True", "VSS-Store-Dev");
  	string enumLine = "";
	  string tokenTemplate="{0}={1},"+ Environment.NewLine;
    var numeric = new char[]{'0','1','2','3','4','5','6','7','8','9'};
	  using (System.Data.SqlClient.SqlConnection sqlconn= new System.Data.SqlClient.SqlConnection(connectionString))
	  {
      sqlconn.Open();
		  using(System.Data.SqlClient.SqlCommand sqlcomm=new System.Data.SqlClient.SqlCommand())
		  {
			  sqlcomm.CommandText = "select * from "+entity.Name;
			  sqlcomm.Connection = sqlconn;
			  using(System.Data.SqlClient.SqlDataReader sqldr= sqlcomm.ExecuteReader())
			  {
				  while(sqldr.Read())
				  {
				    try
				    {
				      var id = sqldr[valueField];
				      string tokenName = sqldr[nameField].ToString();
					    tokenName = tokenName.Replace("-","").Replace(" ","");
              if ( numeric.Contains(tokenName[0]) )
                enumLine += "e";
                
					    enumLine += string.Format(tokenTemplate,tokenName,id);
				    }
				    catch(IndexOutOfRangeException) { }
				  }
			  }
		  }
	  }
	  enumLine = enumLine.Substring(0, enumLine.Length- (Environment.NewLine+",").Length);

	  return enumLine;
	  }
#>