FROM microsoft/dotnet:2.1-sdk-alpine3.7

RUN apk --no-cache add bash
	

#Copy files from scm into build container and build
COPY . /build/

#publish TRex
RUN dotnet publish /build/TRex.netstandard.sln --output /trex

#Gather dependencies - kubernetes support has to be injected here as its not part of the nuget package
RUN cp /root/.nuget/packages/apache.ignite/2.4.0/libs/ /trex/libs/
WORKDIR /trex/libs/
RUN wget https://search.maven.org/remotecontent?filepath=org/apache/ignite/ignite-kubernetes/2.4.0/ignite-kubernetes-2.4.0.jar

#TRex unit tests will be tested by the jenkins file as host directory mounts cannot be specified in the dockerfile
