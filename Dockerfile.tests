FROM microsoft/dotnet:2.1-sdk-alpine as builder

COPY . /build/

WORKDIR /build/AcceptanceTests/scripts
RUN chmod 777 *.sh
RUN ["/bin/sh", "deploy_linux.sh"]

FROM microsoft/dotnet:2.1-runtime-alpine

RUN \
	mkdir -p /aws && \
	apk -Uuv add groff less python py-pip && \
	pip install awscli && \
	apk --purge -v del py-pip && \
	rm /var/cache/apk/*

WORKDIR /app
COPY --from=builder /build/AcceptanceTests/deploy .

RUN sed -i 's/\r$//' rm_cr.sh
RUN chmod 775 rm_cr.sh
RUN ["/bin/sh", "rm_cr.sh"]

VOLUME testresults

CMD ["/bin/sh", "runtests.sh"]


