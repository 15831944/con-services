FROM microsoft/dotnet:2.1-sdk-alpine as build

COPY . /build/

WORKDIR /build/AcceptanceTests/scripts
RUN chmod 777 *.sh
RUN ["/bin/sh", "deploy_linux.sh"]

FROM microsoft/dotnet:2-runtime-jessie

WORKDIR /app
COPY --from=builder /build/AcceptanceTests/deploy .

RUN sed -i 's/\r$//' rm_cr.sh
RUN chmod 775 rm_cr.sh
RUN ["/bin/bash", "rm_cr.sh"]

VOLUME testresults

ENTRYPOINT ["/bin/bash", "runtests.sh"]


